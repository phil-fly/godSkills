#!/bin/bash

Kname=net
Kbuild=`pwd`/Kbuild

echo "#aknet编译的Kbuild文件">$Kbuild

echo "#依赖的文件">> $Kbuild
echo "obj-m += $Kname.o" >> $Kbuild

for f in `find ./src -name "*.c"`
do
    f=${f/.c/.o}
    echo "$Kname-y += $f" >> $Kbuild
done

echo -e "\n" >> $Kbuild
echo -e "#编译选项" >> $Kbuild
echo "EXTRA_CFLAGS += -I`pwd`/src" >> $Kbuild
echo "EXTRA_CFLAGS += -I`pwd`/src/include" >> $Kbuild
echo "ldflags-y   += -T\$(src)/scripts/net.lds" >>$Kbuild
